// Aula 21 - Triggers

CREATE TABLE auditorias (
      id_auditoria    NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      nome_tabela     VARCHAR2(255),
      nome_transacao  VARCHAR2(10),
      por_usuario     VARCHAR2(30),
      data_transacao DATE
);

CREATE OR REPLACE TRIGGER trgr_auditoria_clientes
    AFTER 
    UPDATE OR DELETE 
    ON clientes
    FOR EACH ROW    
DECLARE
   l_transacao VARCHAR2(10);
BEGIN

   l_transacao := CASE  
         WHEN UPDATING THEN 'UPDATE'
         WHEN DELETING THEN 'DELETE'
   END;

      
   INSERT INTO auditorias (nome_tabela, nome_transacao, por_usuario, data_transacao)
   VALUES('clientes', l_transacao, USER, SYSDATE);
END;

UPDATE
   clientes
SET
   limite_credito = 2000
WHERE
   cliente_id =1;
   
SELECT * FROM auditorias;

DELETE FROM clientes
WHERE cliente_id = 1;

SELECT * FROM auditorias;


   
   
   
   
   
   
   
   







